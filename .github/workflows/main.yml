---
name: main

on:
  push:

jobs:
  build:
    strategy:
      matrix:
        build_cmd:
          - ./build-latest.sh
          - ./build.sh main
      fail-fast: false
    runs-on: ubuntu-latest
    name: Build new images
    steps:
      - id: git-checkout
        name: Checkout
        uses: actions/checkout@v2
      - id: docker-build
        name: Build the image with '${{ matrix.build_cmd }}'
        run: ${{ matrix.build_cmd }}
        env:
          GH_ACTION: enable
      - id: docker-test
        name: Test the image
        run: IMAGE="${FINAL_DOCKER_TAG}" ./test.sh
        if: steps.docker-build.outputs.skipped != 'true'
